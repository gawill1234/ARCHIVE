<function name="vse-crawler-seed-filenetp8" type="crawl-seed" products="filenetp8-connector" internal="${project.version}" >
  <prototype>
    <declare required="required" name="host" type="string">
      <label name="label">Host</label>
      <description name="description">The FileNetP8 server host.</description>
    </declare>

    <declare type="string" name="port">
      <label name="label">Port</label>
      <description name="description">The FileNetP8 server port.</description>
    </declare>

    <declare required="required" name="username" type="string">
      <label name="label">Username</label>
      <description name="description">The repository username to authenticate with.
      </description>
    </declare>

    <declare required="required" name="password" type="password">
      <label name="label">Password</label>
      <description name="description">
        The repository password to authenticate with.
      </description>
    </declare>

    <declare required="required" name="objectstore" type="string">
      <label name="label">Object Store</label>
      <description name="description">FileNet P8 Object Store to crawl.</description>
    </declare>

    <declare type="string" name="domain">
      <label name="label">Domain</label>
      <description name="description">
        The domain for the repository (if applicable).
      </description>
    </declare>

    <declare required="required" name="jar-dir" type="string">
      <label name="label">JAR location</label>
      <description name="description">
        Full path to the location of the Java libraries required.
      </description>
    </declare>

    <declare required="required" name="remote-server-url" type="string">
      <label name="label">Remote Server URL</label>
      <description name="description">
        Remote server URL of the P8 web application. 
<p />
The remote server URL is typically of the form:
<p />
http://{P8_client_host}:{port}/wsi/FNCEWS40SOAP
</description>
    </declare>

    <declare required="required" name="remote-server-file-transfer-url" type="string">
      <label name="label">Remote Server File Transfer URL</label>
      <description name="description">
        Remote server file transfer URL of the P8 web application. 
<p />
The remote server file transfer URL is typically of the form:
<p />
http://{P8_client_host}:{port}/wsi/FNCEWS40MTOM
</description>
    </declare>

    <declare required="required" name="web-application-base-url" type="string">
      <label name="label">Web Application Base URL</label>
      <description name="description">
        Base URL of the P8 web application. 
<p />
For Workplace XT the base URL is typically of the form:
<p />
http://{P8_client_host}:{port}/{application_name}
</description>
    </declare>

    <declare name="initialdate" type="string" required="required">
      <label name="label">Initial Date</label>
      <description name="description">
 The first query to FileNetP8 server will be made to retrieve every document before this date. It is recommended to use an older date. The format of the date is YYYY-MM-dd, e.g. 2000-12-21. 
    </description>
    </declare>

    <declare name="offset" type="string" required="required">
      <label name="label">Offset (days)</label>
      <description name="description">
 Specify in number of days the offset for each query. For a larger offset it is likely that the connector will retrieve more documents in each query, e.g. 30. 
     </description>
    </declare>

    <declare type="string" name="chunksize" initial-value="1000">
      <label name="label">Chunk size</label>
      <description name="description">
Chunk size of number of documents to be retrieved in each query.
     </description>
    </declare>

    <declare type="string" name="root-class" initial-value="Document">
      <label name="label">Root Class</label>
      <description name="description">
Root Class of objects to crawl. Use the 'Symbolic Name' of the class (no white spaces).<p />
If the option 'Crawl subclasses' is enabled, all subclasses of the root class will be crawled.<p />
For example:
<code>PreferencesDocument</code>
      </description>
    </declare>

    <declare type="flag" name="crawl-subclasses">
      <label name="label">Crawl subclasses</label>
      <description name="description">If enabled, the connector will also crawl all subclasses of the selected root class.
       </description>
    </declare>

    <declare type="string-area" name="filter-out-classes">
      <label name="label">Filter out classes</label>
      <description name="description">Newline-separated list of classes that will be filtered out. Use the Display Name of the classes (can have white spaces).<p />
For example:
<code>Preferences Document
Publish Template
Workflow Definition
</code>
      </description>
    </declare>

    <declare type="string" name="skip-second-segmentation" initial-value="false" hidden="hidden">
      <label name="label">Skip second segmentation</label>
      <description name="description">
Skip the second segmentation. Only the segmentation based on initial Date and offset will be made.
     </description>
    </declare>

    <declare type="string" name="orderby-parameter" initial-value="updateDate" hidden="hidden">
      <label name="label">Order-by parameter</label>
      <description name="description">
Order-by parameter that will be used. Options are 'contentLength' and 'updateDate'.
     </description>
    </declare>


    <description name="description">Crawl FileNet P8 repository. Supports v4.0 and up.</description>
    <label name="label">FileNet P8</label>
  </prototype>


  <process-xsl><![CDATA[
    <xsl:param name="host"/>
    <xsl:param name="port"/>
    <xsl:param name="username"/>
    <xsl:param name="password"/>
    <xsl:param name="domain"/>
    <xsl:param name="objectstore"/>
    <xsl:param name="jar-dir"/>
    <xsl:param name="remote-server-url"/>
    <xsl:param name="remote-server-file-transfer-url"/>
    <xsl:param name="web-application-base-url"/>
    <xsl:param name="initialdate"/>
    <xsl:param name="offset"/>
    <xsl:param name="chunksize"/>
    <xsl:param name="root-class"/>
    <xsl:param name="crawl-subclasses"/>
    <xsl:param name="filter-out-classes"/>
    <xsl:param name="skip-second-segmentation"/>
    <xsl:param name="orderby-parameter"/>

    <xsl:template match="/">

    <xsl:variable name="extra-options">
      <options>
        <crawl-extender-option name="host">
          <xsl:value-of select="$host"/>
        </crawl-extender-option>
        <crawl-extender-option name="port">
          <xsl:value-of select="$port"/>
        </crawl-extender-option>
        <crawl-extender-option name="domain">
          <xsl:value-of select="$domain"/>
        </crawl-extender-option>
        <crawl-extender-option name="objectstore">
          <xsl:value-of select="$objectstore"/>
        </crawl-extender-option>
        <crawl-extender-option name="repositorytype">FILENETP8</crawl-extender-option>
        <crawl-extender-option name="jar-dir">
          <xsl:value-of select="$jar-dir"/>
        </crawl-extender-option>
        <crawl-extender-option name="remote-server-url">
          <xsl:value-of select="$remote-server-url"/>
        </crawl-extender-option>
        <crawl-extender-option name="remote-server-file-transfer-url">
          <xsl:value-of select="$remote-server-file-transfer-url"/>
        </crawl-extender-option>
        <crawl-extender-option name="web-application-base-url">
          <xsl:value-of select="$web-application-base-url"/>
        </crawl-extender-option>
        <crawl-extender-option name="initialdate">
          <xsl:value-of select="$initialdate"/>
        </crawl-extender-option>
        <crawl-extender-option name="offset">
          <xsl:value-of select="$offset"/>
        </crawl-extender-option>
        <crawl-extender-option name="chunksize">
          <xsl:value-of select="$chunksize"/>
        </crawl-extender-option>
        <crawl-extender-option name="root-class">
          <xsl:value-of select="$root-class"/>
        </crawl-extender-option>
        <xsl:if test="$crawl-subclasses">
         <crawl-extender-option name="crawl-subclasses">true</crawl-extender-option></xsl:if> 
        <crawl-extender-option name="filter-out-classes">
          <xsl:value-of select="$filter-out-classes"/>
        </crawl-extender-option>
        <crawl-extender-option name="skip-second-segmentation">
          <xsl:value-of select="$skip-second-segmentation"/>
        </crawl-extender-option>
        <crawl-extender-option name="orderby-parameter">
          <xsl:value-of select="$orderby-parameter"/>
        </crawl-extender-option>
      </options>
    </xsl:variable>

    <xsl:variable name="root-url">
      <xsl:value-of select="viv:url-build('universal', '', '', $host, $port, '', '')"/>
    </xsl:variable>

    <call-function name="vse-crawler-seed-urls-common">
      <with name="urls" value="{$root-url}" />
      <with name="how" value="path" />
      <with name="username" copy-of="username" />
      <with name="password" copy-of="password" />
      <with name="extra-curl-options" value="{viv:node-to-str($extra-options)}" />
    </call-function>

    <xsl:variable name="extra-jars">
      <xsl:if test="$jar-dir">
          <xsl:value-of select="concat($jar-dir, '/', '&#10;')"/>
          <xsl:for-each select="str:tokenize('activation-1.1.1.jar,commons-beanutils-1.8.0.jar,commons-httpclient-3.1.jar,commons-io-1.4.jar,commons-lang-2.5.jar,commons-logging-1.1.1.jar,cxf-api-2.2.12.jar,cxf-common-utilities-2.2.12.jar,cxf-rt-bindings-soap-2.2.12.jar,cxf-rt-core-2.2.12.jar,cxf-rt-databinding-jaxb-2.2.12.jar,cxf-rt-frontend-jaxws-2.2.12.jar,cxf-rt-frontend-simple-2.2.12.jar,cxf-rt-transports-http-2.2.12.jar,cxf-rt-ws-addr-2.2.12.jar,cxf-rt-ws-security-2.2.12.jar,cxf-tools-common-2.2.12.jar,dime-1.0.3.jar,es_common-4.5.115.jar,es_ecispi.jar,es_filenetp8-ws.jar,jaxb-api-2.2.jar,jaxb-impl-2.2.jar,jaxws-api-2.1-1.jar,jsr173_api-1.0.jar,jsr181-1.0.jar,jsr250-api-1.0.jar,mail-1.4.jar,saaj-api-1.3.jar,saaj-impl-1.3.4.jar,stax-1.2.0.jar,stax-api-1.0-2.jar,wsdl4j-1.6.2.jar,wss4j-1.5.8.jar,XmlSchema-1.4.7.jar,xmlsec-1.3.0.jar', ',')">
          <xsl:value-of select="concat($jar-dir, '/',.,'&#10;')"/>
          </xsl:for-each>
      </xsl:if>
    </xsl:variable>

      <crawl-extender>
        <call-function name="vse-crawler-seed-extender-java-common" no-view-resolved="no-view-resolved">
          <with name="protocol">universal</with>
          <with name="classname">plugin:universal.plugin@filenetp8</with>
          <with name="dns">dns</with>          
          <with name="extra-jars"><xsl:value-of select="$extra-jars"/></with>
          <!--with name="bootstrap-logging">com.vivisimo,TRACE</with-->
        </call-function>
      </crawl-extender>
    </xsl:template>
  ]]></process-xsl>
</function>
